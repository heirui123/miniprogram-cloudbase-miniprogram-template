<view class="payment-test-container">
  <!-- 页面标题 -->
  <view class="page-header">
    <view class="header-title">支付功能测试</view>
    <view class="header-subtitle">测试微信支付功能是否正常工作</view>
  </view>

  <!-- 支付结果 -->
  <view wx:if="{{paymentResult}}" class="payment-result">
    <view class="result-icon {{paymentResult.success ? 'success' : 'fail'}}">
      <text class="iconfont {{paymentResult.success ? 'icon-success' : 'icon-fail'}}"></text>
    </view>
    <view class="result-title">{{paymentResult.message}}</view>
    <view class="result-actions">
      <button wx:if="{{!paymentResult.success}}" class="btn-retry" bindtap="handleRetry">重新测试</button>
      <button class="btn-back" bindtap="handleRetry">继续测试</button>
    </view>
  </view>

  <!-- 测试表单 -->
  <view wx:else class="test-form">
    <!-- 测试金额 -->
    <view class="form-section">
      <view class="section-title">测试金额</view>
      <view class="amount-input">
        <text class="currency">¥</text>
        <input 
          class="input-field" 
          type="digit" 
          value="{{testAmount}}"
          placeholder="请输入测试金额"
          bindinput="onAmountInput"
        />
      </view>
      <view class="amount-tip">建议使用0.01元进行测试</view>
    </view>

    <!-- 测试按钮 -->
    <view class="form-actions">
      <button 
        class="btn-test" 
        bindtap="handleTestPayment" 
        disabled="{{loading}}"
      >
        <text wx:if="{{loading}}">处理中...</text>
        <text wx:else>发起测试支付 ¥{{testAmount}}</text>
      </button>
    </view>

    <!-- 测试说明 -->
    <view class="test-notice">
      <view class="notice-title">测试说明</view>
      <view class="notice-item">• 此页面用于测试支付功能是否正常工作</view>
      <view class="notice-item">• 建议使用0.01元进行测试，避免产生大额费用</view>
      <view class="notice-item">• 测试订单会保存到数据库中</view>
      <view class="notice-item">• 支付成功后可以查看订单状态</view>
    </view>
  </view>

  <!-- 订单历史 -->
  <view class="order-history">
    <view class="history-title">测试订单历史</view>
    <view wx:if="{{orderHistory.length === 0}}" class="empty-history">
      暂无测试订单
    </view>
    <view wx:else class="history-list">
      <view 
        wx:for="{{orderHistory}}" 
        wx:key="orderNo" 
        class="history-item"
        bindtap="queryOrderStatus"
        data-order-no="{{item.orderNo}}"
      >
        <view class="item-header">
          <text class="order-no">{{item.orderNo}}</text>
          <text class="order-status {{item.status}}">{{item.status === 'paid' ? '已支付' : item.status === 'pending' ? '待支付' : '支付失败'}}</text>
        </view>
        <view class="item-content">
          <text class="service-title">{{item.serviceTitle}}</text>
          <text class="amount">¥{{item.totalFee}}</text>
        </view>
        <view class="item-footer">
          <text class="create-time">{{item.createTime}}</text>
          <text class="tap-tip">点击查看状态</text>
        </view>
      </view>
    </view>
  </view>
</view> 