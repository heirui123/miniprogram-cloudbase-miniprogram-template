<!-- order-detail/index.wxml -->
<view class="container">
  <!-- è®¢å•çŠ¶æ€ -->
  <view class="status-section">
    <view class="status-card">
      <view class="status-icon status-{{order.status === 'å¾…æ¥å•' ? 'pending' : order.status === 'è¿›è¡Œä¸­' ? 'in-progress' : order.status === 'å·²å®Œæˆ' ? 'completed' : 'canceled'}}">
        <text class="icon-text">{{order.status === 'å¾…æ¥å•' ? 'â³' : order.status === 'è¿›è¡Œä¸­' ? 'ğŸ”„' : order.status === 'å·²å®Œæˆ' ? 'âœ…' : 'âŒ'}}</text>
      </view>
      <view class="status-info">
        <view class="status-title">{{order.statusText}}</view>
        <view class="status-desc">{{order.statusDesc}}</view>
      </view>
    </view>
    
    <!-- æ¥è‡ªå·±å•çš„ç‰¹æ®Šæç¤º -->
    <view class="own-service-notice" wx:if="{{order.isOwnService}}">
      <view class="notice-icon">ğŸ’¡</view>
      <view class="notice-content">
        <view class="notice-title">æ‚¨æ¥äº†è‡ªå·±çš„æœåŠ¡</view>
        <view class="notice-desc">è¿™æ˜¯æ‚¨å‘å¸ƒçš„æœåŠ¡ï¼Œæ‚¨è‡ªå·±æ¥å•äº†</view>
      </view>
    </view>
  </view>

  <!-- æœåŠ¡ä¿¡æ¯ -->
  <view class="service-info card">
    <view class="section-title">æœåŠ¡ä¿¡æ¯</view>
    <view class="service-content">
      <image class="service-image" src="{{order.service.images[0] || '/images/default-service.png'}}" mode="aspectFill"></image>
      <view class="service-details">
        <view class="service-title">{{order.service.title}}</view>
        <view class="service-desc">{{order.service.description}}</view>
        <view class="service-price">
          <text class="price-symbol">Â¥</text>
          <text class="price-value">{{order.price}}</text>
          <text class="price-unit">{{order.priceUnit}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç”¨æˆ·ä¿¡æ¯ -->
  <view class="user-info card">
    <view class="section-title">ç”¨æˆ·ä¿¡æ¯</view>
    <view class="user-content">
      <view class="user-item">
        <view class="user-label">å‘å¸ƒè€…</view>
        <view class="user-detail">
          <image class="user-avatar" src="{{order.publisher.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
          <view class="user-info-text">
            <view class="user-name">{{order.publisher.nickName}}</view>
            <view class="user-meta">
              <text class="credit-score">ä¿¡ç”¨è¯„åˆ†ï¼š{{order.publisher.creditScore || 100}}</text>
              <text class="member-level">{{order.publisher.memberLevel || 'æ™®é€šç”¨æˆ·'}}</text>
            </view>
          </view>
        </view>
      </view>
      <view class="user-item" wx:if="{{order.receiver}}">
        <view class="user-label">æ¥å•è€…</view>
        <view class="user-detail">
          <image class="user-avatar" src="{{order.receiver.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
          <view class="user-info-text">
            <view class="user-name">{{order.receiver.nickName}}</view>
            <view class="user-meta">
              <text class="credit-score">ä¿¡ç”¨è¯„åˆ†ï¼š{{order.receiver.creditScore || 100}}</text>
              <text class="member-level">{{order.receiver.memberLevel || 'æ™®é€šç”¨æˆ·'}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- è®¢å•ä¿¡æ¯ -->
  <view class="order-info card">
    <view class="section-title">è®¢å•ä¿¡æ¯</view>
    <view class="info-list">
      <view class="info-item">
        <text class="info-label">è®¢å•å·</text>
        <text class="info-value">{{order._id}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">åˆ›å»ºæ—¶é—´</text>
        <text class="info-value">{{order.createTimeText}}</text>
      </view>
      <view class="info-item" wx:if="{{order.updateTimeText !== order.createTimeText}}">
        <text class="info-label">æ›´æ–°æ—¶é—´</text>
        <text class="info-value">{{order.updateTimeText}}</text>
      </view>
      <view class="info-item" wx:if="{{order.paymentTimeText}}">
        <text class="info-label">æ”¯ä»˜æ—¶é—´</text>
        <text class="info-value">{{order.paymentTimeText}}</text>
      </view>
      <view class="info-item" wx:if="{{order.location.address}}">
        <text class="info-label">æœåŠ¡åœ°å€</text>
        <text class="info-value">{{order.location.address}}</text>
      </view>
      <view class="info-item" wx:if="{{order.contactInfo.phone || order.contactInfo.wechat}}">
        <text class="info-label">è”ç³»æ–¹å¼</text>
        <text class="info-value">{{order.contactInfo.phone || order.contactInfo.wechat || 'æš‚æ— '}}</text>
      </view>
      <view class="info-item" wx:if="{{order.requirements}}">
        <text class="info-label">ç‰¹æ®Šè¦æ±‚</text>
        <text class="info-value">{{order.requirements}}</text>
      </view>
    </view>
  </view>

  <!-- æ”¯ä»˜ä¿¡æ¯ -->
  <view class="payment-info card" wx:if="{{order.paymentStatus}}">
    <view class="section-title">æ”¯ä»˜ä¿¡æ¯</view>
    <view class="payment-content">
      <view class="payment-status">
        <text class="payment-label">æ”¯ä»˜çŠ¶æ€</text>
        <text class="payment-value payment-{{order.paymentStatus === 'å·²æ”¯ä»˜' ? 'success' : 'pending'}}">
          {{order.paymentStatus}}
        </text>
      </view>
      <view class="payment-amount">
        <text class="payment-label">æ”¯ä»˜é‡‘é¢</text>
        <text class="payment-value">Â¥{{order.price}}</text>
      </view>
      <view class="payment-time" wx:if="{{order.paymentTimeText}}">
        <text class="payment-label">æ”¯ä»˜æ—¶é—´</text>
        <text class="payment-value">{{order.paymentTimeText}}</text>
      </view>
    </view>
  </view>

  <!-- è®¢å•æ—¶é—´çº¿ -->
  <view class="timeline-section card">
    <view class="section-title">è®¢å•è¿›åº¦</view>
    <view class="timeline">
      <view class="timeline-item {{item.active ? 'active' : ''}}" wx:for="{{timeline}}" wx:key="status">
        <view class="timeline-icon">
          <view class="timeline-dot {{item.active ? 'active' : ''}}"></view>
        </view>
        <view class="timeline-content">
          <view class="timeline-title">{{item.title}}</view>
          <view class="timeline-desc">{{item.desc}}</view>
          <view class="timeline-time">{{item.time}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="btn btn-outline" bindtap="contactUser">è”ç³»ç”¨æˆ·</button>
    
    <!-- æ¥å•æŒ‰é’® - åªæœ‰æ¥å•è€…å¯ä»¥æ“ä½œ -->
    <button class="btn btn-primary" 
            wx:if="{{order.status === 'å¾…æ¥å•' && userInfo && order.receiverId === userInfo.openid}}" 
            bindtap="acceptOrder">
      æ¥å•
    </button>
    
    <!-- å®ŒæˆæŒ‰é’® - åªæœ‰å‘å¸ƒè€…å¯ä»¥æ“ä½œ -->
    <button class="btn btn-secondary" 
            wx:if="{{order.status === 'è¿›è¡Œä¸­' && userInfo && order.publisherOpenId === userInfo.openid}}" 
            bindtap="completeOrder">
      å®Œæˆè®¢å•
    </button>
    
    <!-- æ”¯ä»˜æŒ‰é’® - åªæœ‰æ¥å•è€…å¯ä»¥æ”¯ä»˜ -->
    <button class="btn btn-warning" 
            wx:if="{{order.status === 'è¿›è¡Œä¸­' && order.paymentStatus !== 'å·²æ”¯ä»˜' && userInfo && order.receiverId === userInfo.openid}}" 
            bindtap="payOrder">
      æ”¯ä»˜è®¢å•
    </button>
    
    <!-- å–æ¶ˆæŒ‰é’® -->
    <button class="btn btn-danger" 
            wx:if="{{order.status === 'å¾…æ¥å•' || order.status === 'è¿›è¡Œä¸­'}}" 
            bindtap="cancelOrder">
      å–æ¶ˆè®¢å•
    </button>
    
    <!-- è¯„ä»·æŒ‰é’® -->
    <button class="btn btn-success" 
            wx:if="{{order.status === 'å·²å®Œæˆ'}}" 
            bindtap="reviewOrder">
      è¯„ä»·è®¢å•
    </button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <loading show="{{loading}}" text="åŠ è½½ä¸­..."></loading>
</view> 