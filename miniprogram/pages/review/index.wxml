<view class="container">
  <!-- è¯„ä»·è¡¨å• -->
  <view class="review-form" wx:if="{{showForm}}">
    <view class="form-header">
      <text class="form-title">è¯„ä»·æœåŠ¡</text>
      <text class="service-title">{{orderInfo.serviceTitle}}</text>
    </view>

    <view class="rating-section">
      <text class="rating-label">æœåŠ¡è¯„åˆ†</text>
      <view class="rating-stars">
        <view class="star-item {{index < rating ? 'active' : ''}}" 
              wx:for="{{5}}" wx:key="*this" 
              bindtap="onStarTap" data-index="{{index}}">
          â˜…
        </view>
      </view>
      <text class="rating-text">{{ratingText}}</text>
    </view>

    <view class="review-content">
      <text class="content-label">è¯„ä»·å†…å®¹</text>
      <textarea class="review-textarea" 
                placeholder="è¯·åˆ†äº«æ‚¨çš„æœåŠ¡ä½“éªŒ..." 
                value="{{reviewContent}}"
                bindinput="onContentInput"
                maxlength="500"></textarea>
      <text class="char-count">{{reviewContent.length}}/500</text>
    </view>

    <view class="review-tags">
      <text class="tags-label">é€‰æ‹©æ ‡ç­¾</text>
      <view class="tags-list">
        <view class="tag-item {{item.selected ? 'active' : ''}}" 
              wx:for="{{reviewTags}}" wx:key="id"
              bindtap="onTagSelect" data-id="{{item.id}}">
          {{item.name}}
        </view>
      </view>
    </view>

    <view class="form-actions">
      <button class="btn btn-outline" bindtap="cancelReview">å–æ¶ˆ</button>
      <button class="btn btn-primary" bindtap="submitReview" disabled="{{!canSubmit}}">æäº¤è¯„ä»·</button>
    </view>
  </view>

  <!-- è¯„ä»·åˆ—è¡¨ -->
  <view class="review-list" wx:else>
    <view class="list-header">
      <text class="list-title">è¯„ä»·åˆ—è¡¨</text>
      <view class="filter-tabs">
        <view class="tab-item {{filterType === 'all' ? 'active' : ''}}" 
              bindtap="onFilterChange" data-type="all">å…¨éƒ¨</view>
        <view class="tab-item {{filterType === 'positive' ? 'active' : ''}}" 
              bindtap="onFilterChange" data-type="positive">å¥½è¯„</view>
        <view class="tab-item {{filterType === 'neutral' ? 'active' : ''}}" 
              bindtap="onFilterChange" data-type="neutral">ä¸­è¯„</view>
        <view class="tab-item {{filterType === 'negative' ? 'active' : ''}}" 
              bindtap="onFilterChange" data-type="negative">å·®è¯„</view>
      </view>
    </view>

    <view class="review-items">
      <view class="review-item" wx:for="{{reviewList}}" wx:key="_id">
        <view class="review-header">
          <view class="reviewer-info">
            <image class="reviewer-avatar" src="{{item.reviewer.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
            <view class="reviewer-details">
              <text class="reviewer-name">{{item.reviewer.nickName}}</text>
              <view class="review-rating">
                <view class="rating-stars">
                  <view class="star-item {{index < item.rating ? 'active' : ''}}" 
                        wx:for="{{5}}" wx:key="*this">
                    â˜…
                  </view>
                </view>
                <text class="rating-score">{{item.rating}}.0</text>
              </view>
            </view>
          </view>
          <text class="review-time">{{item.createTimeText}}</text>
        </view>

        <view class="review-content">
          <text class="review-text">{{item.content}}</text>
          <view class="review-tags" wx:if="{{item.tags.length > 0}}">
            <text class="tag-item" wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">
              {{tag}}
            </text>
          </view>
        </view>

        <view class="review-footer">
          <view class="service-info">
            <text class="service-title">{{item.serviceTitle}}</text>
            <text class="service-provider">æœåŠ¡è€…ï¼š{{item.provider.nickName}}</text>
          </view>
          <view class="review-actions">
            <button class="btn btn-small btn-outline" bindtap="likeReview" data-id="{{item._id}}">
              <text class="like-icon">ğŸ‘</text>
              <text class="like-count">{{item.likes || 0}}</text>
            </button>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <empty wx:if="{{reviewList.length === 0 && !loading}}" text="æš‚æ— è¯„ä»·" image="/images/empty-review.png"></empty>

    <!-- åŠ è½½çŠ¶æ€ -->
    <loading show="{{loading}}" text="åŠ è½½ä¸­..."></loading>
  </view>
</view> 