# 需求文档：账号展示与手机号绑定

## 介绍
为个人中心页面新增“账号”展示与手机号绑定能力：
- 默认展示昵称
- 可额外展示“用户ID：xxxxxx”（来源于 openid 尾 6 位，或掩码）
- 支持使用 `open-type="getPhoneNumber"` 一键获取并绑定手机号，后端通过 `cloud.openapi.phonenumber.getPhoneNumber` 解码并入库

## 需求

### 需求 1 - 显示账号信息（昵称 + 用户ID）
**用户故事：** 作为用户，我希望在“我的”页面看到自己的账号标识（昵称与用户ID），方便识别与客服沟通时提供。

#### 验收标准（EARS）
1. When 用户已登录, the 系统 shall 在昵称下方显示一行“用户ID：XXXXXX”，其中 `XXXXXX` 为用户 `openid` 的后 6 位（字母转大写）。
2. When 用户未登录, the 系统 shall 不显示该账号信息行，仅显示“立即登录”。
3. While `openid` 不可用（异常场景）, the 系统 shall 隐藏“用户ID”行并正常渲染页面不报错。

### 需求 2 - 绑定手机号
**用户故事：** 作为用户，我希望在个人中心快捷绑定手机号，作为联系账号和安全校验之用。

#### 验收标准（EARS）
1. When 用户点击“绑定手机号”按钮并同意授权, the 系统 shall 使用 `e.detail.code` 调用后端云函数，通过 `cloud.openapi.phonenumber.getPhoneNumber` 获取手机号，并保存至 `users` 集合 `phoneNumber` 字段中。
2. When 绑定成功, the 系统 shall 立即刷新用户信息并在页面展示掩码手机号（例如 `138****5678`），且不再显示“绑定手机号”按钮。
3. When 用户拒绝授权或系统无法获取手机号, the 系统 shall 显示提示“未授权”或“绑定失败，请重试”，并保持原有状态。
4. When 网络错误或云函数异常, the 系统 shall 以非阻塞方式提示错误，并允许用户稍后重试。

### 需求 3 - 安全与合规
**用户故事：** 作为平台运营者，我希望用户手机号与标识信息的处理符合平台与隐私规范。

#### 验收标准（EARS）
1. While 服务端处理手机号, the 系统 shall 不在日志打印完整手机号，仅记录必要的错误信息及掩码或哈希（如需）。
2. When 返回用户信息到前端, the 系统 shall 仅返回明文手机号用于展示掩码；前端展示时必须进行掩码处理，不在界面或日志展示完整号码。
3. While 更新 `users` 文档, the 系统 shall 仅新增 `phoneNumber`、`phoneBindTime` 字段，不影响既有字段与权限设置。

## 非功能性要求
- 不影响现有登录流程与页面渲染性能
- 满足微信小程序平台关于用户隐私与权限的规范
- 错误反馈友好且不打断主流程 